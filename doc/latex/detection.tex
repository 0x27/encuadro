\chapter{Detección}
\label{ch:detection}
Hola

\section{Típos de características}
Intro y mas breves definiciones?. 

Bordes, esquinas, líneas, segmentos de línea, regiones (blobs). 

\section{Bordes y esquinas}
	\subsection{Detector de bordes de Canny}
	\subsection{Detector de bordes y esquinas de Harris}
	\subsection{SUSAN Y FAST}

\section{Líneas y segmentos de línea}
	\subsection{Detector de líneas de Hough}
	\subsection{Detector de segmentos de línea: LSD}

\section{Regiones y puntos de interés}
	\subsection{FAST}		
	\subsection{Blobs}

%\subsection{Cilindros y esferas}
%\subsubsection{Algortimos de cilindros y esferas}

\section{Detección sin primitivas markerless}
SIFT (puntero a capitulo que tiene SIFT para reconocimiento)
SURF, ETC ETC.

\section{Marcadores}
\label{sec:marcadores}
Marcadores que se usan.
Limitaciones

La inclusión de \emph{marcadores}, \emph{marcas de referencia} o \emph{fiduciales}, en inglés \emph{markers}, \emph{landmarks} o \emph{fiducials}, en la escena ayuda al problema de extracción de características y por lo tanto al problema de estimación de pose \cite{Lepetit05b}. Estos por construcción son elementos que presentan una detección estable en la imagen para el tipo de característica que se desea extraer así como medidas facilmente utilizables para la estimación de la pose.

Se distinguen dos tipos de \emph{fiduciales}. El primer tipo son los que se llaman puntos \emph{fiduciales} por que proveen una correspondencia de puntos entre la escena y la imagen. El segundo tipo, \emph{fiduciales planares}, se pueden obtener mediante la construcción en una geometría coplanar de una serie de \emph{puntos fiduciales} identificables como esquinas. Un único \emph{fiducial planar} puede contener por si solo todas las seis restricciones espaciales necesarias para definir el marco de coordenadas. 

Como se explica en la sección \ref{ch:camaraypose} el problema de estimación de pose requiere de una serie de correspondencias $\mathbf{M}_i\leftrightarrow \mathbf{m}_i$ entre puntos 3D en la escena en coordenadas del mundo y puntos en la imagen. El enfoque elegido 

\section{Marcador QR}
El enfoque inicial elegido para la detección de \emph{puntos fiduciales} para marcadores parte del trabajo de fin de curso de Matías Tailanian para el curso \emph{Tratamiento de imágenes por computadora} de Facultad de Ingeniería, Universidad de la Republica\footnote{Autoposicionamiento 3D -  http://sites.google.com/site/autoposicionamiento3d/}. La elección se basa principalmente en los buenos resultados obtenidos para dicho trabajo con un enfoque relativamente simple. El trabajo desarrolla, entre otras cosas, un diseño de marcador y un sistema de detección de marcadores basado en el detector de segmentos LSD\cite{grompone10} por su buena performance y aparente bajo costo computacional. 

El marcador utilizado está basado en la estructura de detección incluida en los códigos \emph{QR} y se muestra en la figura \ref{fig:Marker}. Éste consiste en trés grupos idénticos de tres cuadrados concéntricos superpuestos de tal forma que los lados de cada uno de trés cuadrados son visualizables. A diferencia de los códigos \emph{QR} la disposición de los grupos de cuadrados es distinto para evitar ambiguedades en la determinación  de su posicionamiento espacial. Estas dos características son escenciales para la extracción de los \emph{puntos fiduciales} de forma coherente, es decir, las correspondencias tienen que poder ser determinadas completamente bajo criterios razonables.
\begin{figure}[h!]
\centering
\includegraphics[scale=0.3]{figs_detection/Marker.eps}
\caption{Marcador propuesto basado en la estructura de detección de códigos QR.}
\label{fig:Marker}
\end{figure}

\subsection{Estructura del marcador}
A continuación se presentan algunas definiciones de las estructuras básicas que constituyen el marcador propuesto. Estas son de utilidad para el diseño y forman un flujo natural y escalable para el desarrollo del algoritmo de determinación de correspondencias.\\

Los elementos mas básicos en la estructura son los \emph{segmentos} los cuales consisten en un par de puntos en la imagen, $\mathbf{p} = (p_x,p_y)$ y $\mathbf{q} = (q_x,q_y)$. Estos \emph{segmentos} forman lo que son los lados del \emph{cuadrilátero}, el próximo elemento estructural del marcador.\\

Un \emph{cuadrilátero} o \emph{quadrilateral} en inglés, al que se le denomina $\text{Ql}$, está determinado por cuatro segmentos conexos y distintos entre sí. El cuadrilátero tiene dos propiedades notables; el \emph{centro} definido como el punto medio entre sus cuatro vértices y el \emph{perímetro} definido como la suma de el largo de sus cuatro lados. Los \emph{vértices} de un \emph{cuadrilátero} se determinan mediante la intersección, en sentido amplio, de dos segmentos contiguos. Es decir, si $s_1$ es contiguo a $s_2$ dadas las recta $r_1$ que pasa por los puntos $\mathbf{p}_1$, $\mathbf{q}_1$ del segmento $s_1$ y la recta $r_2$ que pasa por los puntos $\mathbf{p}_2$, $\mathbf{q}_2$ del segmento $s_2$, se determina el vértice correspondiente como la intersección $r_1 \cap r_2$. \\
%La propiedad de conexión entre dos segmentos se relaja a la intersección de dos discos de un cierto radio en torno a los puntos de dos segmentos vecinos. \\

A un \emph{conjunto de cuadriláteros} o \emph{quadrilateral set} se le denomina $\text{QlSet}$, se construye a partir de $\text{M}$ cuadriláteros, que comparten un mismo centro, y se diferencian por un factor de escala, con $\text{M}>1$. A partir de dichos cuadriláteros se construye un lista ordenada $(\text{Ql}[0],\text{Ql}[1],\dots,\text{Ql}[\text{M}-1])$ en donde el orden viene dado por el valor de \emph{perímetro} de cada \texttt{Ql}. Se define el \emph{centro del grupo de cuadriláteros} como el promedio de los centros de cada $\text{Ql}$ de la lista ordenada.\\

Finalmente el \emph{marcador QR} está constituido por $\text{N}$ \emph{conjuntos de cuadriláteros} dispuestos en una geometría particular. Esta geometría permite la determinación un sistema de coordenadas; un origen y dos ejes a utilizar. Se tiene una lista ordenada  $(\text{QlSet}[0],\text{QlSet}[1],\dots,\text{QlSet}[\text{N}-1])$ en donde el orden se puede determinar mediante la geometría de los mismos o a partir de hipótesis razonables.\\

Un marcador proveerá un numero de $\text{4}\times\text{M}\times\text{N}$ vértices y por lo tanto la misma cantidad de puntos fiduciales para proveer las correspondencias  $\mathbf{M}_i\leftrightarrow \mathbf{m}_i$ al algoritmo de estimación de pose.\\

\subsection{Diseño}
En base a las estructuras previamente definidas es que se describe el diseño del marcador. Como ya se explicó se toma un marcador tipo \emph{QR} basado en \emph{cuadriláteros} y mas específicamente en tres conjuntos de tres cuadrados dispuestos en como se muestra en la figura \ref{fig:Marker}.\\

Los tres \emph{cuadriláteros} correspondientes a un mismo \emph{conjunto de cuadriláteros} tienen idéntica alineación e idéntico centro. Los diferencia un factor de escala, esto es, $\text{Ql}[0]$ tiene lado $l$ mientras que $\text{Ql}[1]$ y $\text{Ql}[2]$ tienen lado $2l$ y $3l$ respectivamente. Esto se puede ver en la figura \ref{fig:QlSetDetail}. Adicionalmente se define un sistema de coordenadas con centro en el centro del $\text{QlSet}$ y ejes definidos como $\textbf{x}$ horizontal a la derecha e $\textbf{y}$ vertical hacia abajo. Las direcciones de los ejes son muy utilizadas en el ambiente de las imágenes para definir los ejes de una imagen. Definido el sistema de coordenadas de puede fijar un orden a los \emph{vértices} $v_{j_{1}}$ de cada \emph{cuadrilátero} $\text{Ql}[\text{j}]$ como, \\
\begin{eqnarray}
v_{j_{0}} = (\alpha,\alpha) && v_{j_{1}} = (\alpha,-\alpha)  \\
v_{j_{2}} = (-\alpha,-\alpha) && v_{j_{3}} = (-\alpha,\alpha)
\end{eqnarray}
con $\alpha=(j+1)\times l$. El orden aquí explicado se puede ver también junto con el sistema de coordenadas en la figura \ref{fig:MarkerDetail}.\\
\begin{figure}[h!]
\centering
\includegraphics[scale=0.35]{figs_detection/QlSetDetail.eps}
\caption{Detalle de un QlSet. Orden de los \emph{cuadriláteros} a la izquiera. Órden de los \emph{vértices} a la derecha.}
\label{fig:QlSetDetail}
\end{figure}


Un detalle del marcador se muestra en la figura \ref{fig:MarkerDetail} en donde se define el conjunto $\text{i}$ de cuadriláteros concéntricos como el $\text{QlSet}[\text{i}]$ y se definen los respectivos centros $\mathbf{c}_i$ para cada $\text{QlSet}[\text{i}]$. El sistema de coordenadas del \emph{marcador QR} tiene centro en el centro del $\text{QlSet}[0]$ y ejes de coordenadas idénticos al definido para cada $\text{Ql}$. Se tiene además que los ejes de coordenadas pueden ser obtenidos mediante los vectores normalizados,
\begin{equation}
\begin{split}
\mathbf{x}  = \frac{\mathbf{c}_1 - \mathbf{c}_0}{||\mathbf{c}_1-\mathbf{c}_0||} & \quad
\mathbf{y}  = \frac{\mathbf{c}_2 - \mathbf{c}_0}{||\mathbf{c}_2-\mathbf{c}_0||}
\end{split}
\end{equation}

La disposición de los $\text{QlSet}$ es tal que la distancia indicada $\mathbf{d}_{01}$ definida como la norma del vector entre los centros $\mathbf{c}_1$ y $\mathbf{c}_0$ es significativamente mayor que la distancia $\mathbf{d}_{02}$ definida como la norma del vector entre los centros $\mathbf{c}_2$ y $\mathbf{c}_1$. Esto es, $\mathbf{d}_{01}\gg\mathbf{d}_{02}$. Este criterio facilita la identificación de los \emph{vértices} de los $\text{QlSet}$ entre sí basados únicamente en la posición de sus centros y se explicará en la parte de determinación de correspondencias (sec.: \ref{subsec:detection_correspondencias}).
\begin{figure}[h!]
\centering
\includegraphics[scale=0.3]{figs_detection/MarkerDetail.eps}
\caption{Detalle del marcador propuesto formando un sistema de coordenadas.}
\label{fig:MarkerDetail}
\end{figure}

%  lo que determina una cantidad de $3\times \text{QlSet}$'s conteniendo $3 \times \text{Ql}$'s cada uno. Bajo esta elección de parámetros se tienen $36$ \emph{segmentos} y \emph{vértices}.\\

\subsection{Filtrado de segmentos}

\subsection{Determinación de correspondencias}
\label{subsec:detection_correspondencias}

\section{Resultados}

